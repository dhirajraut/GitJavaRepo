
function updateJobDescription(dateFormat,jobDescExist)
  {
   var w = document.createJobsCEForm.sel5.selectedIndex;
   var ops_text = document.createJobsCEForm.sel5.options[w].text;
 
  var etaDate=document.getElementById("etadate").value;
  var finishDate=document.getElementById("finishdate").value;
  var servLoc=document.getElementById("serviceLoc").value;
  var date;
 if(finishDate != "" && finishDate != null)
   {
	   date=jobDescDate(finishDate,dateFormat);
   }
 else
   {
	date = jobDescDate(etaDate,dateFormat);
   }
  if(date == null)
  date="";
  	var svLoc= new Array();
	svLoc = servLoc.split(",")
	var newServLoc="";
	var i=0;
	while(i<svLoc.length)
	{
		if(i==0)
	    newServLoc = trimAll(svLoc[i]);
		else
		newServLoc = newServLoc+","+" "+trimAll(svLoc[i]);
	  i++;
	}
var desc = ops_text+" "+"of"+" "+" "+"on"+" "+"at"+" "+newServLoc+" "+"on"+" "+date;
  if(jobDescExist == 'jobdescexist')
  {
	 document.getElementById("jobDesc").value=desc;
     return desc; 
  }
   
    if(document.getElementById("jobDesc").value=="")
     {
     document.getElementById("jobDesc").value=desc;
     return desc; 
    }
    else
    return document.getElementById("jobDesc").value;
}


//remove this function later
 function updateServiceLocationIframeSrc() 
 {
	  var serviceLocationName= document.getElementById("serviceLoc").value;	  
	  var branchName=document.getElementById("brnch").value;
	  document.createJobsCEForm.tabName.value = "0";
	    if(serviceLocationName != "" && serviceLocationName != null) {  
			 document.getElementById('serv').setAttribute("src","search_serviceLocation_popup.htm?inputFieldId=serviceLocationName&div1=servloc&div2=servlocbody&serviceLcoationName="+serviceLocationName + "&branchName="+branchName+"&reqForm=jobsForm");   
		   } else { 
			  document.getElementById('serv').setAttribute("src","search_serviceLocation_popup.htm?inputFieldId=serviceLocationName&div1=servloc&div2=servlocbody&serviceLcoationName="+serviceLocationName +"&branchName="+branchName+"&reqForm=jobsForm");   
	      }
   }
   
   
 function showServiceLocationSearch(){
  var serviceLocationName= document.getElementById("serviceLoc").value;	  
	  var branchName=document.getElementById("brnch").value;
	  document.createJobsCEForm.tabName.value = "0";
	    if(serviceLocationName != "" && serviceLocationName != null) {  
		  document.getElementById('serv').setAttribute("src",src="search.htm?searchType=serviceLocation&targetFieldId=serviceLocationName&div1=servloc&div2=servlocbody&serviceLcoationName="+serviceLocationName + "&branchName="+branchName+"&searchForm=createJobsCEForm");
		  } else { 
			  document.getElementById('serv').setAttribute("src",src="search.htm?searchType=serviceLocation&targetFieldId=serviceLocationName&div1=servloc&div2=servlocbody&serviceLcoationName="+serviceLocationName + "&branchName="+branchName+"&searchForm=createJobsCEForm");   
	      }
 }
   

   function setServiceLcoationFlag()
  {        
    document.createJobsCEForm.serviceLocationFlag.value="servicelocation";
    document.createJobsCEForm.tabName.value = "0";    
  }

  function popServiceLocation()
  {
	  popup_show('servloc','servloc_drag','servloc_exit', 'screen-corner', 12, 5);
	  hideIt();
	  showPopupDiv('servloc','servlocbody');
	  popupboxenable();
  }

	 function popUserDetails(){
	  popup_show('userDetails','userDetails_drag','userDetails_exit', 'screen-corner', 120,  20);
	  hideIt();	
	  showPopupDiv('userDetails','userDetailsbody');
	  popupboxenable();
	 }


  function enterButton() {
  if (event.keyCode == 13) {
   if(document.getElementById("ccode").value!="") {
    setform();
   }
  }
}

function showWarehouseSearch(){	
	var buName=document.getElementById("sel3").value;
	if(buName == "" || buName == null){
		confirm("Please select BusinessUnit!");
		return true;
  	}
	document.createJobsCEForm.tabName.value = "0";
    if(buName!= "" && buName!= null){
    	//document.getElementById('jobbu').setAttribute("src", src="search.htm?searchType=warehouse&targetFieldId=warehouseName&div1=jobbranchcode&div2=jobbranchcodebody&buName="+buName+"&formName=createJobsCEForm");
    	document.getElementById('jobbu').setAttribute("src",src="search.htm?searchType=warehouse&targetFieldId=warehouseName&div1=jobbranchcode&div2=jobbranchcodebody&buName="+buName+"&searchForm=createJobsCEForm");    	
        popup_show('jobbranchcode', 'jobbranchcode_drag', 'jobbranchcode_exit', 'screen-corner', 120, 20);
  	  	hideIt();
  	  	showbranchcode('jobbranchcode','jobbranchcodebody');
  	  	popupboxenable();
    }
  }
  
  
  
  
/*for generic popup*/
function showSalesRepSearch(){    
    document.getElementById('recievedFr').setAttribute("src",src="search.htm?searchType=user&targetFieldId=salesPersonName&div1=userDetails&div2=userDetailsbody&searchForm=createJobsCEForm&role=salesRep");
}

function showSecondarySalesRepSearch(){
    document.getElementById('recievedFr').setAttribute("src",src="search.htm?searchType=user&targetFieldId=secondarySalesPersonName&div1=userDetails&div2=userDetailsbody&searchForm=createJobsCEForm&role=secondarySalesRep");
}

function showProjectManagerSearch(){
   document.getElementById('recievedFr').setAttribute("src",src="search.htm?searchType=user&targetFieldId=projectManagerName&div1=userDetails&div2=userDetailsbody&searchForm=createJobsCEForm");
}

function showBankSearch(rowIndex,buname,currency){
	document.getElementById('sremittoframe').setAttribute("src",src="search.htm?searchType=bank&targetFieldId=remitto" +rowIndex +
		"&buName="+buname+"&currency="+currency+"&searchForm=createJobsCEForm");
}

function showBankAccountSearch(rowIndex, buname,currency){
 var bcode=document.getElementById("remitto"+rowIndex).value;
 document.getElementById('saccountframe').setAttribute("src",src="search.htm?searchType=bankaccount&targetFieldId=bankaccount" + rowIndex +
 		"&buName="+buname+"&currency="+currency+"&bankCode="+bcode+"&searchForm=createJobsCEForm");
}

function updateContactIframeSrc(rowIndex,customercode, contactType){
	document.getElementById('searchContactFr').setAttribute("src","search.htm?searchType=contactCust&targetFieldId="+contactType+"&searchForm=createJobsCEForm&callerRowIndex="+rowIndex+"&divName=searchcontact&divbody=contactbody"+rowIndex+"&custCode="+customercode);
}

/* up to here */  
  
 function popContact(){ 
  popup_show('searchcontact',	'searchcontact_drag', 'searchcontact_exit', 'screen-corner', 120,	20);
  hideIt();
  showPopupDiv('searchcontact','contactbody'); 
  popupboxenable();
 } 
  
  
function updateBranchIframeSrc()
{	
var buName= document.getElementById("sel3").value;
if(buName == "" || buName == null){
	confirm("Please select BusinessUnit!");
	return true;
	}
  if(buName!= "" && buName!= null){
   document.getElementById('jobbu').setAttribute("src",src="search_branch_popup.htm?inputFieldId=warehouseName&div1=jobbranchcode&div2=jobbranchcodebody&buName="+buName+"&formName=createJobsCEForm");
      popup_show('jobbranchcode', 'jobbranchcode_drag', 'jobbranchcode_exit', 'screen-corner', 120, 20);
	  hideIt();
	  showbranchcode('jobbranchcode','jobbranchcodebody');
	  popupboxenable();
  }
}

function popJobBranch(){
 popup_show('jobbranchcode', 'jobbranchcode_drag', 'jobbranchcode_exit', 'screen-corner', 120, 20);
	  hideIt();
	  showbranchcode('jobbranchcode','jobbranchcodebody');
	  popupboxenable();
}

function popServiceOffering(){
 popup_show('serviceoff', 'serviceoff_drag', 'serviceoff_exit', 'screen-corner', 120, 20);
	  hideIt();
	  showbranchcode('serviceoff','serviceoffbody');
	  popupboxenable();
}




function makeBranchblank()
{
  document.getElementById("brnch").value="";
}

function showRequiredFields(){
	var myFrame=document.getElementById("requiredFieldsFrame");
	myFrame.src="required_fields.htm";
	popup_show('requiredFields', 'requiredFields_drag', 'requiredFields_exit', 'screen-corner', 120, 20);
	hideIt();
	popupboxenable();
}

/*remove the below function once the generic popup is working fine.
function updateBankAccountIframe(buname,currency){
var bcode=document.getElementById("remitto").value;
document.getElementById('saccountframe').setAttribute("src","search_bank_account_popup.htm?inputFieldId=remitToBankAccountNum&buName="+buname+"&currency="+currency+"&bankCode="+bcode);
}


function updateBankIframe(buname,currency){ 	
document.getElementById('sremittoframe').setAttribute("src","search_bank_popup.htm?inputFieldId=remitToCode&buName="+buname+"&currency="+currency);
}

 up to here*/

//these functions were moved to ce_jobentry.js file
/*function updateCustomerAddNoteIframeSrc(jobNumber){
	document.getElementById('customerNoteFr').setAttribute("src","job_order_note_popup.htm?id="+jobNumber+"&divName=note");
}

function updateCustomerAttachIframeSrc(jobNumber){
document.getElementById('customerAttachFileFr').setAttribute("src","job_order_attachfile_popup.htm?jobNumber="+jobNumber+"&divName=attach&inputFieldId=attachedFileNames");
}*/

function updateCustomerIframeSrc() {
	document.createJobsCEForm.tabName.value = "1";	
	var code = document.getElementById('ccode').value;
	if (code == null || code == "") {
		confirm("Please Enter search string(s)");
		return true;
	}
	if (code != null && code != ""){
		document.getElementById('customerFr').setAttribute("src", 'search.htm?searchType=contractCustContact&targetFieldId=inputFieldIdValue&div1=customerSearch&div2=customerSearchbody&searchForm=createJobsCEForm&searchValue=' + code);
		popup_show('customerSearch','customerSearch_drag','customerSearch_exit', 'screen-corner', 120,20);
		hideIt();
		showPopupDiv('customerSearch','customerSearchbody');
		popupboxenable();
	}
}

function billingContactAjax()
{
  document.createJobsCEForm.jobFlag.value="none";
  document.createJobsCEForm.deleteFlag.value ="none";
  document.createJobsCEForm.contactFlag.value="contFlag";
  document.createJobsCEForm.tabName.value="1";
  document.createJobsCEForm.submit();
}

function setbankFlag(index){
document.createJobsCEForm.bankFlag.value="bankFlag";
document.createJobsCEForm.tabName.value="1";
document.createJobsCEForm.bankIndex.value=index;
document.createJobsCEForm.submit();
}

function replaceHtmlCode(address){
	var newAddr;
	newAddr = address.replace(/&#045;/gi, "-");
	newAddr = newAddr.replace(/&#035;/gi, "#");
	return newAddr;
}

function showError(ecode,sc)
{
if(sc!="")
{	
 confirm("some or all of the entered criteria resulted in error. Review the errors below.\n No products were find matching the entered criteria "+ ecode +". change the criteria and try again");
 document.getElementById("ccode").value=sc;
 document.createJobsCEForm.submit();
}
else{
confirm("some or all of the entered criteria resulted in error. Review the errors below.\n No products were find matching the entered criteria "+ ecode +". change the criteria and try again");
document.createJobsCEForm.ccode.focus();
document.createJobsCEForm.ccode.value="";
}
}



function setform()
{
  var code=document.getElementById("ccode");
  confirm("Searching CECustomer by " + code.value);
  if(code.value==null || code.value=="")
  {
    confirm("Please Enter A customer name or contact name");
    return false;
  }
  document.createJobsCEForm.submit();
   
}

function setDeleteflag(index)
{
if (confirm("Are you sure you want to delete the row?")==true)
{
// document.createJobsCEForm.jobFlag.value="none";
 document.createJobsCEForm.getElementById('contractIndex').value = index;
 document.createJobsCEForm.getElementById('actionFlag').value ="deleteCustomer";
 confirm('index = ' + index);
 document.createJobsCEForm.submit();
}
}
function resetJobValFlag()
{
 document.createJobsCEForm.contactFlag.value="none";
 document.createJobsCEForm.jobFlag.value="none";
 document.createJobsCEForm.popFlag.value="none";
  document.createJobsCEForm.uniqueFlag.value="none";
  setpage();
}

function resetJob(index,ccc)
{
if(index>1)
{
var cc=ccc;
if(ccc.charAt("/"))
{ cc=ccc.replace("/","'");}
 document.getElementById("ccode").value=cc;
 document.createJobsCEForm.submit();
}
else{ 
 setpage();
}	
}



function isAdd(string) 
{
   if (!string) return false;
   var iChars = "*|,\":<>[]{}`\()&$#%./!@~?><";
   for (var i = 0; i < string.length; i++) {
    if (iChars.indexOf(string.charAt(i)) != -1)
    return false;
   }
   return true;
}


function isProper(string)
{
   if (!string) return false;
   var iChars = ";";
   var i=string.length-1;
    if (iChars.lastIndexOf(string.charAt(i)) != -1)
  {    return false;}
     return true;
} 

function isValid(string)
{
   if (!string) return false;
   var iChars = ";";
   var i=string.length-1;
    if (iChars.lastIndexOf(string.charAt(0)) != -1)
  {    return false;}
     return true;
}


function goToNextPage(dateFormat,flag){
	
	var servLoc=document.getElementById("serviceLoc").value;
	if(servLoc == "" || servLoc == null){
		confirm("Please select Servicelocation!");
		return false;
	}
	
	if(flag=='true'){
		confirm("Please select customer before you move to next page!");
		return false;
	}
	updateJobDescription(dateFormat);
	var form=document.createJobsCEForm;
	form.actionFlag.value="next";
	form.submit();
}


//quick search funciton
function checkSearchField()
{
  if(document.getElementById("searchValue").value=="")
  {
  confirm("Please enter a search string");
  return false;
  }
  else{
	    if (confirm("All the modifications you have done will not be saved. do you want to continue?")==true)
	    {
	    
	    var w = document.getElementById('sel1').selectedIndex;
        var ops_text = document.getElementById('sel1').options[w].text;	    
        var svalue=document.getElementById("searchValue").value; 
        document.getElementById('searchFr').setAttribute("src","search_ce_job_popup.htm?searchString="+ops_text+"&searchValue="+svalue+"&div1=searchDetails&div2=searchDetailsbody");       
	    }
	    else{
	      return false;
	    }  
	}
}
//quick search funciton
function popSearchDetails(){
	  parent.popup_show('searchDetails','searchDetails_drag','searchDetails_exit', 'screen-corner', 120,  20);	 
	  parent.hideIt();	
	  parent.showPopupDiv('searchDetails','searchDetailsbody');	  
	  parent.popupboxenable();	  
	 }	 

//quick search function.
function revertToEntry(jobNumber){
window.parent.location ='job_entry_ce.htm?jobNumber='+jobNumber;
}


function quickSearchMessage(){
confirm("The search string does not have any records! ");
document.getElementById("searchValue").focus();
document.getElementById("searchValue").value="";
}

function setsubflag()
{
//document.createJobsCEForm.jobValFlag.value="newjobval";
//document.createJobsCEForm.tabName.value = "1";
}

function setcontactflag()
{
 /* document.createJobsCEForm.jobFlag.value="none";
  document.createJobsCEForm.deleteFlag.value ="none";
  document.createJobsCEForm.contactIndex.value=rowIndex;
  document.createJobsCEForm.contactFlag.value="contFlag";
  document.createJobsCEForm.tabName.value="1";
  */
}

function setAttachFilesFlag()
{
  //document.createJobsCEForm.attachFilesFlag.value=rowIndex;
  //document.createJobsCEForm.tabName.value="1";
}

function submitform()
    {
      top.document.forms[0].submit();  
    }


function setpage()
{
document.createJobsCEForm.ccode.value="";
}
 
function trimAll(sString) 
{
while (sString.substring(0,1) == ' ') 
{ 
sString = sString.substring(1, sString.length); 
} 
while (sString.substring(sString.length-1, sString.length) == ' ') 
{ 
sString = sString.substring(0,sString.length-1); 
} 
return sString; 
} 

function updateDescription(index,dateFormat)
{
if(document.getElementById("invoiceDescrdetails"+index).value=="")
  {  
  var description="General service charge in connection with the"+" "+updateJobDescription(dateFormat)+".";
  document.getElementById("invoiceDescrdetails"+index).value=description;
  }
else
  {
  var description=document.getElementById("invoiceDescrdetails"+index).value;
  document.getElementById("invoiceDescrdetails"+index).value=description
  }
}

function changeVisibleStyle(){
    document.getElementById("serviceLoc").value="";
}


 
  function contractAttach(contractCode,index)
  {
   document.getElementById('contractFr'+index).setAttribute("src","view_contract_attach_popup.htm?contractCode="+contractCode);
  }
 
function selectJobDateBoolean(flag)
 {
 document.createJobsCEForm.submit();
 }
 

function setBillingAsScheduler(index, contact_id, contact_name, address){
	var sameBilling = document.getElementById('sameBillingAsScheduler'+index).checked;
	if (sameBilling){
		document.getElementById('billingContactId'+index).value=contact_id;
		document.getElementById('billingContactName'+index).value=contact_name;
		document.getElementById('billingContactAddress'+index).value=replaceHtmlCode(address);
	}else{
		document.getElementById('billingContactId'+index).value=0;
		document.getElementById('billingContactName'+index).value='';
		document.getElementById('billingContactAddress'+index).value='';
	}
}

function jobDescDate(date,dateFormat)
{
	 var dayfield;
     var monthfield;
     var yearfield;
 
  if('dd/MM/yyyy'== dateFormat)
  {
   dayfield=date.split("/")[0]
   monthfield=date.split("/")[1]
   yearfield=date.split("/")[2]
  }
   if('MM/dd/yyyy'== dateFormat)
  {
   dayfield=date.split("/")[1]
   monthfield=date.split("/")[0]
   yearfield=date.split("/")[2]
  }
   if('dd/MMM/yyyy'== dateFormat)
  {
   dayfield=date.split("/")[0]
   monthfield=date.split("/")[1]
   yearfield=date.split("/")[2]
  }
  
     if(monthfield == 01 || monthfield == 1 || monthfield == 'Jan')
	   {
		 if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"January"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="January"+" "+dayfield+","+" "+yearfield;
	   }
     if(monthfield == 02 || monthfield == 2 || monthfield == 'Feb')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"February"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="February"+" "+dayfield+","+" "+yearfield;
	   }
     if(monthfield == 03 || monthfield == 3 || monthfield == 'Mar')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"March"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="March"+" "+dayfield+","+" "+yearfield;
	   }
     
     if(monthfield == 04 || monthfield == 4 || monthfield == 'Apr')
		{
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"April"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="April"+" "+dayfield+","+" "+yearfield;
	   }
       
     if(monthfield == 05 || monthfield == 5 || monthfield == 'May')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"May"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="May"+" "+dayfield+","+" "+yearfield;
	   }
     if(monthfield == 06 || monthfield == 6 || monthfield == 'jun')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"June"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="June"+" "+dayfield+","+" "+yearfield;
	   }
     
     if(monthfield == 07 || monthfield == 7 || monthfield == 'jul')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"July"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="July"+" "+dayfield+","+" "+yearfield;
	   }
      
     if(monthfield == 08 || monthfield == 8 || monthfield == 'Aug')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"August"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="August"+" "+dayfield+","+" "+yearfield;
	   }
      
     if(monthfield == 09 || monthfield == 9 || monthfield == 'Sep')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"September"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="September"+" "+dayfield+","+" "+yearfield;
	   }
      
     if(monthfield == 10 || monthfield == 'Oct')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"October"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="October"+" "+dayfield+","+" "+yearfield;
	   }
      
     if(monthfield == 11 || monthfield == 'Nov')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"November"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="November"+" "+dayfield+","+" "+yearfield;
	   }
      
      
     if(monthfield == 12 || monthfield == 'Dec')
	   {
	     if('dd/MM/yyyy'== dateFormat || 'dd/MMM/yyyy'== dateFormat)
		 date=dayfield+" "+"December"+","+" "+yearfield;
		 if('MM/dd/yyyy'== dateFormat)
		 date="December"+" "+dayfield+","+" "+yearfield;
	   }
	
	   return date;
}

function setflag(scode,pageNumber)
{  
//document.createJobsCEForm.jobFlag.value="jobval";
//document.createJobsCEForm.tabName.value = "1";
var buname=document.getElementById("sel3").value;
var pageN0=pageNumber;
var code= scode;
if(scode.charAt("/"))
{ code=scode.replace("/","'");}
if(code!= "" && code!= null)
{
document.getElementById("pu").setAttribute("src","search_ce_customer_popup.htm?inputFieldId=inputFieldIdValue&searchForm=createJobsCEForm&code="+code+"&pageNumber="+pageN0+"&buName="+buname+"&fromPage=1");
}
}

function setCode(scode)
{  
var code=scode;
if(scode.charAt("/"))
{ code=scode.replace("/","'");}
document.createJobsCEForm.ccode.value=code;
//document.createJobsCEForm.uniqueFlag.value="uniqueFlag";
document.createJobsCEForm.submit();
}

function setNomCheck(index)
{
  document.getElementById("nom").checked = true;
}

function submitSearch(pageNumber){	 
//	document.ceCustomerSearchPopUpForm.pageNumber.value = pageNumber;
//	document.ceCustomerSearchPopUpForm.excel.value="false";
//	document.ceCustomerSearchPopUpForm.submit();
	var url = document.location;
	var urlString = url.toString();

	var pageNoPos = urlString.indexOf("pageNo");
	if ( pageNoPos != -1){
		var partOne = urlString.substr(0, pageNoPos);
		var partTwo = urlString.substr(pageNoPos, urlString.length);
		url = partOne + "pageNo=" + pageNumber;
	}else{
		url += "&pageNo="+pageNumber;
	}
	document.location = url;
}	


/* for job instructions*/

	function onSaveLines()
	{
		document.jobOrderOpInstrCEForm.addOrDeleteTestLines.value="save";	  
		document.jobOrderOpInstrCEForm.scrollFlag.value="testLine";
		top.document.forms[0].submit(); 
	}

	function onSaveLinesAndNext()
	{
		document.jobOrderOpInstrCEForm.addOrDeleteTestLines.value="saveandnext";	  
		document.jobOrderOpInstrCEForm.scrollFlag.value="testLine";
		top.document.forms[0].submit(); 
	}


	function onAddTestLines()
	{
		document.jobOrderOpInstrCEForm.addOrDeleteTestLines.value="add";	  
		document.jobOrderOpInstrCEForm.scrollFlag.value="testLine";
		top.document.forms[0].submit(); 
	}

	function onDelTestLines(index)
	{
		document.jobOrderOpInstrCEForm.addOrDeleteTestLines.value="delete";	  
		document.jobOrderOpInstrCEForm.testIndex.value=index;
		document.jobOrderOpInstrCEForm.scrollFlag.value="testLine";
		top.document.forms[0].submit(); 
	}
	
	
	function onAddDepositLines(){
	  document.jobOrderOpInstrCEForm.addOrDeleteDepositLines.value="adddep";
	  top.document.forms[0].submit();
	}
	
	function onDelDepositLines(index)
	{
		document.jobOrderOpInstrCEForm.addOrDeleteDepositLines.value="deldep";	  
		document.jobOrderOpInstrCEForm.depIndex.value=index;
		top.document.forms[0].submit(); 
	}
	
	
	function onAddSplitTestLines(index){
	document.jobOrderOpInstrCEForm.addOrDeleteSplitLines.value="addspl";
	document.jobOrderOpInstrCEForm.splitIndex.value=index;
	top.document.forms[0].submit(); 
	}
	
	function onDelSplitTestLines(tIndex,sIndex){
	document.jobOrderOpInstrCEForm.addOrDeleteSplitLines.value="delspl";
	document.jobOrderOpInstrCEForm.testIndex.value=tIndex;
	document.jobOrderOpInstrCEForm.splitIndex.value=sIndex;
	top.document.forms[0].submit(); 
	}
	
	
	function onProject()
	{
	  if(confirm('Are you sure you want to create the project? Have you verified the line items?')==true){
             document.jobOrderOpInstrCEForm.projectFlag.value="true";	
	          submitform();
      }
	
	}
	
	function onSendWebService(webServiceType)
	{
	document.jobOrderOpInstrCEForm.webServiceFlag.value = webServiceType;
	submitform();
	} 

	function updateNoteIframeSrc(index,jobNumber,lineId,splitId){
	document.getElementById('jobContractNoteFr'+index).setAttribute("src","job_instruction_note_popup.htm?JobOrderNumber="+jobNumber+"&orderLineId="+lineId+"&splitLineId="+splitId+"&divName=note"+index);
	}

	function updateAttachIframeSrc(index,jobNumber,lineId,splitId){	
	document.getElementById('jobContractAttachFileFr'+index).setAttribute("src","job_instruction_attachfile_popup.htm?JobOrderNumber="+jobNumber+"&orderLineId="+lineId+"&splitLineId="+splitId+"&divName=attach"+index+"&inputFieldId=attachedFileNames");
	}


		function onDelete(noteId){
			document.getElementById("deleteNoteId").value=noteId;
			document.NotePopUpForm.submit();
		}

		function onSelectNote(noteId){
			document.getElementById("selectedNoteId").value=noteId;
			document.NotePopUpForm.submit();
		 }

		function onReset(){
			document.getElementById("reset").value="reset";
			document.NotePopUpForm.submit();
		}

		function confirmDelete(){
			var yesno = confirm ("Are you sure you want to delete this note?");
			if (yesno == true)
				return true;
				else
			return false;
		 }

		function beforesubmit(){
			if(document.NotePopUpForm.notesummary.value.length==0){
				confirm("Please fill Summary ");
				setFocus(document.NotePopUpForm.notesummary);
				}else{
			document.NotePopUpForm.submit();
			}
		}
          function jobInstructionNoteSubmit(){
			if(document.NotePopUpForm.noteSummary.value.length==0){
				confirm("Please fill Summary ");
				setFocus(document.NotePopUpForm.noteSummary);
				}else{
			document.NotePopUpForm.requestAction.value="save";	
			document.NotePopUpForm.submit();
			}
		}

		//Set Focus
		function setFocus(id){
		try {
		id.focus();
		}
		catch (e){}
		}

function onDeleteAttach(attachId)
  {
  	    var yesno = confirm ("Are you sure you want to delete this attchment?");
	    if (yesno == true)
	    {
		    document.getElementById("deleteAttachId").value=attachId;
		    document.jobAttachFilePopUpForm.submit();
		}
	    else
	      return false;
  }
  
  function onSaveAttach(attachId, desc, type)
  {
    document.getElementById("saveFlag").value='true';
    document.jobAttachFilePopUpForm.submit();
  }

	
	/* moved to ce_jobInstruction.js
	
	function updateOthersIframeSrc(testIndex,splIndex){		
		if(splIndex ==-1)
		{
		 document.getElementById('othersFr'+testIndex).setAttribute("src","job_instruction_test_attribute_popup.htm?testIndex="+testIndex+"&splitIndex="+splIndex+"&div1=others"+testIndex+"&div2=othersbody"+testIndex);
		}
		else
		{
		document.getElementById('othersFr'+testIndex).setAttribute("src","job_instruction_test_attribute_popup.htm?testIndex="+testIndex+"&splitIndex="+splIndex+"&div1=others"+testIndex+"&div2=othersbody"+testIndex);
		}
	}*/

	function saveTestAttrib(testIndex,splIndex){		
		document.jobOrderOpInstrCEForm.addOrDeleteTestLines.value="saveother";
		document.jobOrderOpInstrCEForm.testIndex.value=testIndex;
		document.jobOrderOpInstrCEForm.splitIndex.value=splIndex;
		top.document.jobOrderOpInstrCEForm.submit(); 	
	}


	function searchPopups(entity,inputField)
   {
	url="";
	var callingFunction="";
	if(entity=='branchid')
	{
      url="search.htm?searchType=warehouse&targetFieldId="+inputField+"&searchForm=jobInstructionTestAttribForm";
	}
	else if(entity=='servicelocation')
	{
     url="search.htm?searchType=serviceLocation&targetFieldId="+inputField+"&searchForm=jobInstructionTestAttribForm";
	} 
	else if(entity=='ponumber')
	{
     url="search.htm?searchType=po&targetFieldId="+inputField+"&searchForm=jobInstructionTestAttribForm";
	}
	else if(entity=='taskmanage')
	{
	
     url="search.htm?searchType=user&targetFieldId="+inputField+"&searchForm=jobInstructionTestAttribForm";
     
	}
	//joblogCE window...............
	else if(entity=='projectManager')
	{
    url="search.htm?searchType=user&targetFieldId="+inputField+"&searchForm=jobCeSearchForm";
	}
	else if(entity=='serviceLocation')
	{
     url="search.htm?searchType=serviceLocation&targetFieldId="+inputField+"&searchForm=jobCeSearchForm";
	} 
	else if(entity=='taskManager' )
	{
    url="search.htm?searchType=user&targetFieldId="+inputField+"&searchForm=jobCeSearchForm";
	}
	else if(entity=='salesRep' )
	{	
    url="search.htm?searchType=user&targetFieldId="+inputField+"&searchForm=jobCeSearchForm";
	}
	else if(entity=='reviewerName' )
	{
    url="search.htm?searchType=user&targetFieldId="+inputField+"&searchForm=jobCeSearchForm";       
	}
	else if(entity=='taskOwningOrg' )
	{
     url="search.htm?searchType=warehouse&targetFieldId="+inputField+"&searchForm=jobCeSearchForm";
	} 	
	//newwindow=window.open(url,entity,'height=630,width=600,resizable=yes');
	newwindow=window.open(url,'lookup','height=630,width=600,resizable=no');
	if (window.focus) {newwindow.focus()}
	return false;
}

function showSearchPageinIFrame(iFrameName,html,fieldId,div1name,div2name,formName)
{
 url = +"'"+html+"?inputFieldId="+fieldId+"&div1="+div1name+"&div2="+div2name+"&formName="+formName + "'";
 document.getElementById(iFrameName).setAttribute("src",src=url); 
}

function doSubmit(flag,index)
{
 document.jobInstructionTestAttribForm.workertimeFlag.value=flag;
 document.jobInstructionTestAttribForm.rowNum.value=index;
 document.jobInstructionTestAttribForm.submit(); 
}


function submitPOSearch(pageNumber){  
	document.purchaseOrderPopupForm.pageNumber.value = pageNumber;
	document.purchaseOrderPopupForm.submitFlag.value="true";
	document.purchaseOrderPopupForm.submit();
}	

function submitFunction(){
	document.purchaseOrderPopupForm.pageNumber.value = "1";
	document.purchaseOrderPopupForm.sortFlag.value = "";
	document.purchaseOrderPopupForm.submitFlag.value="true";
	document.purchaseOrderPopupForm.submit();
}

function sortPOByNumber(){
	document.purchaseOrderPopupForm.pageNumber.value = "1";
	document.purchaseOrderPopupForm.sortFlag.value = "poNumber";
	document.purchaseOrderPopupForm.submit();
}
function sortPOByBalanceAmount(){
	document.purchaseOrderPopupForm.pageNumber.value = "1";
	document.purchaseOrderPopupForm.sortFlag.value = "balanceAmount";
	document.purchaseOrderPopupForm.submit();
}

function goToNext(){
	 document.jobOrderOpInstrCEForm.nextPageFlag.value = "2";
	 document.jobOrderOpInstrCEForm.submit();
}
function save()
{
  document.jobInstructionTestAttribForm.workertimeFlag.value='save';
  document.jobInstructionTestAttribForm.submit();
}

function searchContact(){
	document.ceContactSearchPopUpForm.submit();
}

function submitFrameForm(frameName)
{
	window.frames[frameName].document.getElementById("requestAction").value="save";
	window.frames[frameName].document.forms[0].submit();
}

function searchjob()
{
	
  document.getElementById("requestAction").value="search";
  document.getElementById("tabNavigationTo").value="main";
  document.jobCeSearchForm.submit();
}

function navenable(tabNavigableTo)
{
  if(tabNavigableTo!='goto')
  {
   if(tabNavigableTo=='new search')
   {	
	document.getElementById("requestAction").value="new search";
	document.jobCeSearchForm.method="GET";
	tabNavigableTo='searchCriteria';	
   }
   else
   {
   	document.getElementById("requestAction").value="navigation";
   }
   document.getElementById("tabNavigationTo").value=tabNavigableTo;
   document.jobCeSearchForm.submit();
  }
}

function addRow(tableID,inputName)
{
            var table = document.getElementById(tableID);   
  			var rowCount = table.rows.length;
			fldName= inputName+"["+rowCount+"]";
			var size=42;
					
			tmpStr1='';
			if(tableID=='TaskTable' ||tableID=='ProjectManagerTable' || tableID=='salesRepTable')
			{
			  
				tmpStr1="&nbsp;<a href='#pm' onClick=\"javascript:lookupFunction('"+fldName+"','"+tableID+"');popUserDetails();\">";
			}else 
			if(tableID=='taskOwingTable' ||tableID=='ProjectOwning' )
			{
				tmpStr1="&nbsp;<a href='#pm' onClick=\"javascript:lookupFunction('"+fldName+"','"+tableID+"');popJobBranch();\">";
			}else 
			if(tableID=='ServiceOfferingTable')
			{
				tmpStr1="&nbsp;<a href='#pm' onClick=\"javascript:lookupFunction('"+fldName+"','"+tableID+"');popServiceOffering();\">";
			}
			else
			{
			    //tmpStr1="&nbsp;<a href='#pm' onClick=\"javascript:lookupFunction('"+fldName+"','"+tableID+"');popup_show('receivedby','receivedby_drag','receivedby_exit', 'screen-corner',	120,20);hideIt();showPopupDiv('receivedby','receivedbybody');popupboxenable();\">";
			}
			
			if(tableID=='ProjectManagerTable' || tableID=='taskOwingTable' )
			{
				size=38
			}
			if(tableID=='ServiceOfferingTable')
			{
			 tmpStr="<INPUT type=text id='"+fldName+"' class='inputBoxblue' name='"+fldName+"' size='"+size+"' maxlength='42'/>";
			}
			else
			{
			 tmpStr="<INPUT type=text id='"+fldName+"' class='inputBoxblue' name='"+fldName+"' size='"+size+"' maxlength='42'/>";
			}
			tmpStr=tmpStr+tmpStr1;
			tmpStr=tmpStr+"<img src='images/lookup.gif' alt='lookup Task Manager' width='13' height='13' border='0'></a>";
            var row = table.insertRow(rowCount);     
            var cell1 = row.insertCell(0);   			
			cell1.style.padding='0px';
			cell1.innerHTML =tmpStr;
			fld = inputName+rowCount;
			//if(tableID!='ServiceOfferingTable')
			{
				//includeAjaxObj(tableID,fld);
				includeAjaxObj(tableID,fldName);				
			}
}

function includeAjaxObj(tableID,fld)
{
		url='';				
		if(	tableID=='TaskTable')
		{
			receivedBy="entity=com.intertek.entity.User,textAttribute=loginName,valueAttribute=loginName,~loginName={"+fld+"}";
		}
		else 
		if(	tableID=='ProjectManagerTable')
		{
			receivedBy="entity=com.intertek.entity.User,textAttribute=loginName,valueAttribute=loginName,~loginName={"+fld+"}";
		}
		else 
		if(	tableID=='salesRepTable')
		{
			receivedBy="entity=com.intertek.entity.User,textAttribute=loginName,valueAttribute=loginName,~loginName={"+fld+"}";
		}
		else 
		if(	tableID=='taskOwingTable')
		{
			receivedBy="entity=com.intertek.phoenix.entity.Warehouse,textAttribute=name,valueAttribute=name,~name={"+fld+"}";
		}
		else
		if(	tableID=='ProjectOwning')
		{
			receivedBy="entity=com.intertek.phoenix.entity.Warehouse,textAttribute=name,valueAttribute=name,~name={"+fld+"}";
		}
		else
		if(	tableID=='ServiceOfferingTable')
		{
			receivedBy="entity=com.intertek.phoenix.entity.ServiceOffering,textAttribute=description,valueAttribute=description,~description={"+fld+"}";
		}
		
		new AjaxJspTag.Autocomplete(
		"ajax.htm", {
		source: fld,
		target: fld,
		minimumCharacters: "3",
		className: "autocomplete",
		parameters:receivedBy 
		});
}

function showLookup(arg1,arg2,arg3,arg4)
{
	popup_show(arg1, arg2, arg3, arg4, 40, 80); 
	searchtaskmanagerht(); 
	hidetaskmanagersearch(); 
	hideIt();
	popupboxenable();
}
 
function lookupFunction(fieldName,lookupName)
{

	if(lookupName=='TaskTable' || lookupName=='ProjectManagerTable' || lookupName=='salesRepTable')
	{
		 document.getElementById('recievedFr').setAttribute("src","search.htm?searchType=user&targetFieldId="+fieldName+"&searchForm=jobInstructionTestAttribForm");
	}
	else if(lookupName=='taskOwingTable' || lookupName== 'ProjectOwning')
	{		
		document.getElementById('jobbu').setAttribute("src","search.htm?searchType=warehouse&targetFieldId="+fieldName+"&searchForm=jobInstructionTestAttribForm");
	}	
	else if(lookupName=='stream')
	{
		document.getElementById('buStreamFr').setAttribute("src","search.htm?searchType=stream&targetFieldId="+fieldName+"&div1=buStream&div2=buStreambody");
	}
	else if(lookupName=='ServiceOfferingTable')
	{
		document.getElementById('serviceoffIdLookup').setAttribute("src",src="search.htm?searchType=serviceoffering&targetFieldId="+fieldName+"&searchForm=jobCeSearchForm");   	
	}
} 
 
function gotoPage(pageNumber)
{

	if(pageNumber=='First')
	{
	   pageNumber="1";
	}
	else if(pageNumber=='Prev')
	{
	   if(document.jobCeSearchForm.pageNumber.value>0)
	   {
	   	pageNumber=document.jobCeSearchForm.pageNumber.value-1;
	   }
	}
	else if(pageNumber=='Next')
	{
	   if(document.jobCeSearchForm.pageNumber.value>0)
	   {
	   	pageNumber=document.jobCeSearchForm.pageNumber.value+1;
	   }
	}
	
	document.getElementById("requestAction").value="page";
	document.jobCeSearchForm.pageNumber.value = pageNumber;
	document.jobCeSearchForm.submit();
}

function sortByPage(fieldName)
{
	document.getElementById("requestAction").value="sortBy";
	document.getElemenntById("sortField").value=fieldName;
	document.jobCeSearchForm.pageNumber.value = 1;
	document.jobCeSearchForm.submit();
}

function lastSearch(totalRecords,numInPages)
{
	var pageNumber;
	var quotient=totalRecords/numInPages;
	var remainder=totalRecords%numInPages;	
	if(remainder==0)
	pageNumber=quotient;
	else
	pageNumber=Math.floor(quotient)+1;
	gotoPage(pageNumber);
}

function shortByField(fieldName)
{
  document.getElementById("requestAction").value="sort";
  document.getElementById("sortField").value=fieldName;
  //document.getElementById("tabNavigationTo").value="main";
  document.jobCeSearchForm.submit();
}

function exportToExcel()
{
  document.getElementById("requestAction").value="excelupload";
  document.jobCeSearchForm.submit();
}


function popCreditReason(index, invoiceId, viewFlag)
{  
  document.jobOrderEditViewCEInvoiceForm.index.value=index;
  popup_show('creditreason_' + index, 'creditreason_drag_' + index, 'creditreason_exit_' + index, 'screen-corner', 120, 20);
  hideIt();
  popupboxenable();
  document.getElementById("creditreasonbox_" + index).src="credit_reason_ce_popup.htm?invoiceId=" + invoiceId +"&viewFlag=" +viewFlag +"&contractIndex="+index;              
  document.getElementById("creditreasonbox_" + index).height = "250px";
}

function onSave()
{
//document.jobOrderEditViewCEInvoiceForm.contractIndex.value=myIndex;
document.jobOrderEditViewCEInvoiceForm.submit();
}

function popCreditFlag(){
 document.jobOrderEditViewCEInvoiceForm.creditFlag.value="credit";
}
 function submitceform()
  {
  	top.document.forms[0].creditFlag.value = "credit";
  	top.document.forms[0].creditReasonNote.value = document.getElementById("note").value;
  	top.document.forms[0].creditReasonUser.value = document.getElementById("user").value;
	top.document.forms[0].submit();
  }
  
  function validateFields(div1,div2,viewFlag)
  {
  
  	if(viewFlag != '' && viewFlag == 'readonly')
  	{
  			  	top.hidePopupDiv(div1,div2);
	  			top.popupboxclose();
	  			
  	}
  	else
  	{
	  	if(document.getElementById("note").value == '')
	  	{
	  		confirm("Please enter the credit reason note");
	  		return false;
	  	}
	  	  	if(document.getElementById("user").value == '')
	  	{
	  		confirm("Please enter the credit reason approval manager");
	  		return false;
	  	}
	  	
	  	submitceform();
	  	top.hidePopupDiv(div1,div2);
	  	popupboxclose();
	  	
  	}
  	
  }


   function formfocus() {
       document.getElementById('note').focus();
   }

   
   var xmlHttp;
   function initXmlHttp(callback){
   	try{  // Firefox, Opera 8.0+, Safari  
   	  	xmlHttp=new XMLHttpRequest();  
   	}
   	catch (e){  // Internet Explorer  
   		try{    
   			xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");    
   		}
   		catch (e){
   			try{      
   				xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");      
   			}
   			catch (e){
   				alert("Your browser does not support AJAX!");      
   				return false;      
   			}    
   		}  
   	}

   	/*
   	0 The request is not initialized 
   	1 The request has been set up 
   	2 The request has been sent 
   	3 The request is in process 
   	4 The request is complete 
   */	
   	xmlHttp.onreadystatechange=callback;
   }

   function createProject(form){
   	if(confirm('Are you sure you want to create the project? Have you verified the line items?')){
   		var projectTypeIndex=form.projectType.selectedIndex;

   		initXmlHttp(function(){
   			if(xmlHttp.readyState==4){
   				form.projectId.value=xmlHttp.responseText;
   			}
   		});
   		xmlHttp.open("POST", "create_project.htm", true);
   		xmlHttp.send(getQueryString(form));
   		
   	}
   }
   
   /*
    * return the query string for the given form
    */
   function getQueryString(form){
	   return "hello=1&x=true";
   }

function updateEditPriceIframeSrc(lineItemNumber, itemType) {
   document.getElementById('editPriceFrId').setAttribute(
   "src", "edit_price_popup.htm?type="+itemType+"&index="+lineItemNumber);
}

function updateTavelExpenseIframeSrc() {
   document.getElementById('editPrice1FrId').setAttribute("src", "travel_expense_popup.htm");
}
   
function showEditPrice() {
	document.getElementById("editprice").style.display = "block";
}

function hideEditPrice() {
	document.getElementById("editprice").style.visibility="hidden";
	document.getElementById("editprice").style.display = "none";
	showIt();
}
 
function popTravelExpenses() {
	popup_show('editprice1', 'editprice1_drag', 'editprice1_exit', 'screen-corner', 40, 80);
	showEditPrice1();
	hideIt();
	popupboxenable();
} 

function showEditPrice1() {
	document.getElementById("editprice1").style.display = "block";
}

function hideEditPrice1() {
	document.getElementById("editprice1").style.visibility="hidden";
	document.getElementById("editprice1").style.display = "none";
	showIt();
}  
function delete_row(index){    
    document.ceJobSelectChargesForm.rowindex.value = index;
    document.ceJobSelectChargesForm.refreshing.value="deleterow";
    document.ceJobSelectChargesForm.submit();       
}

function submitEditPriceForm() {
	top.popupboxclose();
	top.hideEditPrice();
	document.editPricePopupForm.submit();
	top.document.ceJobSelectChargesForm.refreshing.value="editPrice";
	top.document.ceJobSelectChargesForm.submit();
}
  
function submitTravelExpenseForm() {
	top.popupboxclose();
	top.hideEditPrice1();
	document.travelExpensePopupForm.submit();
	top.document.ceJobSelectChargesForm.refreshing.value="addTravelExpenses";
	top.document.ceJobSelectChargesForm.submit();
}


function saveNextSelectCharges() {
	document.ceJobSelectChargesForm.refreshing.value="next";
	document.ceJobSelectChargesForm.submit();
}

function saveSelectCharges() {
    document.ceJobSelectChargesForm.refreshing.value="save";
	document.ceJobSelectChargesForm.submit();
}
  
  
// Add Test

function showAddTest() {
	document.getElementById("addTest").style.display = "block";
}

function updateAddTestIframeSrc() {
   document.getElementById('addTestId').setAttribute("src", "add_test.htm");
}  
  
function popAddTest() {
	popup_show('addTest', 'addTest_drag', 'addTest_exit', 'screen-corner', 40, 80);
	showAddTest();
	hideIt();
	popupboxenable();
}  


//Add Job Services

function showAddJS() {
	document.getElementById("addJS").style.display = "block";
}

function updateJobServicesIframeSrc() {
   document.getElementById('addJSId').setAttribute("src", "add_job_services.htm");
}  
  
function popJobServices() {
	popup_show('addJS', 'addJS_drag', 'addJS_exit', 'screen-corner', 40, 80);
	showAddJS();
	hideIt();
	popupboxenable();
}

function onSelectService() {
    document.ceServicePopupForm.operation.value = "selectService";
    document.ceServicePopupForm.submit();
}


  
